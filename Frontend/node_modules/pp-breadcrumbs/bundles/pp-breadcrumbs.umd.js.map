{"version":3,"file":"pp-breadcrumbs.umd.js.map","sources":["ng://pp-breadcrumbs/lib/breadcrumbs.resolver.ts","ng://pp-breadcrumbs/lib/breadcrumbs.service.ts","ng://pp-breadcrumbs/lib/breadcrumbs.component.ts","ng://pp-breadcrumbs/lib/breadcrumbs.module.ts"],"sourcesContent":["import { ActivatedRouteSnapshot, Resolve, RouterStateSnapshot, UrlSegment } from '@angular/router';\r\nimport { Observable, of } from 'rxjs';\r\nimport { Breadcrumb } from './breadcrumb';\r\nimport { Injectable } from '@angular/core';\r\nimport { template, templateSettings } from 'lodash';\r\n\r\ntemplateSettings.interpolate = /{{([\\s\\S]+?)}}/g;\r\n\r\n@Injectable()\r\nexport class PpBreadcrumbsResolver implements Resolve<Breadcrumb[]> {\r\n\r\n  resolve(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): Observable<Breadcrumb[]> | Promise<Breadcrumb[]> | Breadcrumb[] {\r\n    const data = route.routeConfig.data;\r\n    const path = this.getFullPath(route);\r\n    const rawText = typeof data.breadcrumbs === 'string' ? data.breadcrumbs : data.breadcrumbs.text || data.text || path;\r\n\r\n    return of([\r\n      {\r\n        path: path,\r\n        text: this.stringFormat(rawText, route.data)\r\n      }\r\n    ]);\r\n  }\r\n\r\n  getFullPath(route: ActivatedRouteSnapshot): string {\r\n    const relativePath = (segments: UrlSegment[]) => segments.reduce((a, v) => (a += '/' + v.path), '');\r\n    const fullPath = (routes: ActivatedRouteSnapshot[]) => routes.reduce((a, v) => (a += relativePath(v.url)), '');\r\n    return fullPath(route.pathFromRoot);\r\n  }\r\n\r\n  private stringFormat(templateString: string, binding: any): string {\r\n    const compiled = template(templateString);\r\n    return compiled(binding);\r\n  }\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport { ActivatedRoute, ActivatedRouteSnapshot, NavigationEnd, Router } from '@angular/router';\r\nimport { Observable, BehaviorSubject, of, concat, from } from 'rxjs';\r\n\r\nimport { PpBreadcrumbsResolver } from './breadcrumbs.resolver';\r\nimport { filter, mergeMap, distinct, toArray, first } from 'rxjs/operators';\r\nimport { Breadcrumb } from './breadcrumb';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PpBreadcrumbsService {\r\n\r\n  postProcess: (crumbs: Breadcrumb[]) => Promise<Breadcrumb[]> | Observable<Breadcrumb[]> | Breadcrumb[];\r\n\r\n  private breadcrumbs = new BehaviorSubject<Breadcrumb[]>([]);\r\n  private defaultResolver = new PpBreadcrumbsResolver();\r\n\r\n  get crumbs$(): Observable<Breadcrumb[]> {\r\n    return this.breadcrumbs;\r\n  }\r\n\r\n  constructor(private router: Router, route: ActivatedRoute, private injector: Injector) {\r\n    this.router.events.pipe(filter(x => x instanceof NavigationEnd)).subscribe((event: NavigationEnd) => {\r\n      this.resolveCrumbs(router.routerState.snapshot.root)\r\n        .pipe(\r\n          mergeMap(breadcrumbs => breadcrumbs),\r\n          distinct(breadcrumb => breadcrumb.text),\r\n          toArray(),\r\n          mergeMap(breadcrumbs => {\r\n            return this.postProcess ? this.wrapIntoObservable(this.postProcess(breadcrumbs)).pipe(first()) : of(breadcrumbs);\r\n          })\r\n        )\r\n        .subscribe(breadcrumbs => {\r\n          this.breadcrumbs.next(breadcrumbs);\r\n        });\r\n    });\r\n  }\r\n\r\n  private resolveCrumbs(route: ActivatedRouteSnapshot): Observable<Breadcrumb[]> {\r\n    let crumbs$: Observable<Breadcrumb[]> = of([]);\r\n    const data = route.routeConfig && route.routeConfig.data;\r\n\r\n    if (data && data.breadcrumbs) {\r\n      const resolver: PpBreadcrumbsResolver =\r\n        data.breadcrumbs.prototype instanceof PpBreadcrumbsResolver ? this.injector.get(data.breadcrumbs) : this.defaultResolver;\r\n\r\n      const result = resolver.resolve(route, this.router.routerState.snapshot);\r\n      crumbs$ = this.wrapIntoObservable<Breadcrumb[]>(result).pipe(first());\r\n    }\r\n\r\n    return route.firstChild ? concat(crumbs$, this.resolveCrumbs(route.firstChild)) : crumbs$;\r\n  }\r\n\r\n  private wrapIntoObservable<T>(value: T | Promise<T> | Observable<T>): Observable<T> {\r\n    return value instanceof Observable ? value : this.isPromise(value) ? from(Promise.resolve(value)) : of(value as T);\r\n  }\r\n\r\n  private isPromise(value: any): boolean {\r\n    return value && typeof value.then === 'function';\r\n  }\r\n}\r\n","import {Component, OnDestroy, OnInit} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { Breadcrumb } from './breadcrumb';\r\nimport { PpBreadcrumbsService } from './breadcrumbs.service';\r\n\r\n@Component({\r\n  selector: 'pp-breadcrumbs',\r\n  templateUrl: './breadcrumbs.component.html',\r\n  styleUrls: ['./breadcrumbs.component.scss']\r\n})\r\nexport class PpBreadcrumbsComponent implements OnInit, OnDestroy {\r\n  crumbs: Breadcrumb[];\r\n  subscriptions: Subscription[] = [];\r\n\r\n  constructor(public service: PpBreadcrumbsService) {}\r\n\r\n  public ngOnInit(): void {\r\n    this.subscriptions.push(\r\n      this.service.crumbs$.subscribe(x => {\r\n        this.crumbs = x;\r\n      })\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscriptions.forEach(x => x.unsubscribe());\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport {RouterModule} from '@angular/router';\nimport {CommonModule} from '@angular/common';\n\nimport { PpBreadcrumbsComponent } from './breadcrumbs.component';\n\n@NgModule({\n  declarations: [PpBreadcrumbsComponent],\n  imports: [CommonModule, RouterModule],\n  exports: [PpBreadcrumbsComponent]\n})\nexport class PpBreadcrumbsModule { }\n"],"names":["templateSettings","of","template","Injectable","BehaviorSubject","filter","NavigationEnd","mergeMap","distinct","toArray","first","concat","Observable","from","Router","ActivatedRoute","Injector","Component","NgModule","CommonModule","RouterModule"],"mappings":"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"}
