{"version":3,"file":"pp-breadcrumbs.js.map","sources":["ng://pp-breadcrumbs/lib/breadcrumbs.resolver.ts","ng://pp-breadcrumbs/lib/breadcrumbs.service.ts","ng://pp-breadcrumbs/lib/breadcrumbs.component.ts","ng://pp-breadcrumbs/lib/breadcrumbs.module.ts"],"sourcesContent":["import { ActivatedRouteSnapshot, Resolve, RouterStateSnapshot, UrlSegment } from '@angular/router';\r\nimport { Observable, of } from 'rxjs';\r\nimport { Breadcrumb } from './breadcrumb';\r\nimport { Injectable } from '@angular/core';\r\nimport { template, templateSettings } from 'lodash';\r\n\r\ntemplateSettings.interpolate = /{{([\\s\\S]+?)}}/g;\r\n\r\n@Injectable()\r\nexport class PpBreadcrumbsResolver implements Resolve<Breadcrumb[]> {\r\n\r\n  resolve(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): Observable<Breadcrumb[]> | Promise<Breadcrumb[]> | Breadcrumb[] {\r\n    const data = route.routeConfig.data;\r\n    const path = this.getFullPath(route);\r\n    const rawText = typeof data.breadcrumbs === 'string' ? data.breadcrumbs : data.breadcrumbs.text || data.text || path;\r\n\r\n    return of([\r\n      {\r\n        path: path,\r\n        text: this.stringFormat(rawText, route.data)\r\n      }\r\n    ]);\r\n  }\r\n\r\n  getFullPath(route: ActivatedRouteSnapshot): string {\r\n    const relativePath = (segments: UrlSegment[]) => segments.reduce((a, v) => (a += '/' + v.path), '');\r\n    const fullPath = (routes: ActivatedRouteSnapshot[]) => routes.reduce((a, v) => (a += relativePath(v.url)), '');\r\n    return fullPath(route.pathFromRoot);\r\n  }\r\n\r\n  private stringFormat(templateString: string, binding: any): string {\r\n    const compiled = template(templateString);\r\n    return compiled(binding);\r\n  }\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport { ActivatedRoute, ActivatedRouteSnapshot, NavigationEnd, Router } from '@angular/router';\r\nimport { Observable, BehaviorSubject, of, concat, from } from 'rxjs';\r\n\r\nimport { PpBreadcrumbsResolver } from './breadcrumbs.resolver';\r\nimport { filter, mergeMap, distinct, toArray, first } from 'rxjs/operators';\r\nimport { Breadcrumb } from './breadcrumb';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PpBreadcrumbsService {\r\n\r\n  postProcess: (crumbs: Breadcrumb[]) => Promise<Breadcrumb[]> | Observable<Breadcrumb[]> | Breadcrumb[];\r\n\r\n  private breadcrumbs = new BehaviorSubject<Breadcrumb[]>([]);\r\n  private defaultResolver = new PpBreadcrumbsResolver();\r\n\r\n  get crumbs$(): Observable<Breadcrumb[]> {\r\n    return this.breadcrumbs;\r\n  }\r\n\r\n  constructor(private router: Router, route: ActivatedRoute, private injector: Injector) {\r\n    this.router.events.pipe(filter(x => x instanceof NavigationEnd)).subscribe((event: NavigationEnd) => {\r\n      this.resolveCrumbs(router.routerState.snapshot.root)\r\n        .pipe(\r\n          mergeMap(breadcrumbs => breadcrumbs),\r\n          distinct(breadcrumb => breadcrumb.text),\r\n          toArray(),\r\n          mergeMap(breadcrumbs => {\r\n            return this.postProcess ? this.wrapIntoObservable(this.postProcess(breadcrumbs)).pipe(first()) : of(breadcrumbs);\r\n          })\r\n        )\r\n        .subscribe(breadcrumbs => {\r\n          this.breadcrumbs.next(breadcrumbs);\r\n        });\r\n    });\r\n  }\r\n\r\n  private resolveCrumbs(route: ActivatedRouteSnapshot): Observable<Breadcrumb[]> {\r\n    let crumbs$: Observable<Breadcrumb[]> = of([]);\r\n    const data = route.routeConfig && route.routeConfig.data;\r\n\r\n    if (data && data.breadcrumbs) {\r\n      const resolver: PpBreadcrumbsResolver =\r\n        data.breadcrumbs.prototype instanceof PpBreadcrumbsResolver ? this.injector.get(data.breadcrumbs) : this.defaultResolver;\r\n\r\n      const result = resolver.resolve(route, this.router.routerState.snapshot);\r\n      crumbs$ = this.wrapIntoObservable<Breadcrumb[]>(result).pipe(first());\r\n    }\r\n\r\n    return route.firstChild ? concat(crumbs$, this.resolveCrumbs(route.firstChild)) : crumbs$;\r\n  }\r\n\r\n  private wrapIntoObservable<T>(value: T | Promise<T> | Observable<T>): Observable<T> {\r\n    return value instanceof Observable ? value : this.isPromise(value) ? from(Promise.resolve(value)) : of(value as T);\r\n  }\r\n\r\n  private isPromise(value: any): boolean {\r\n    return value && typeof value.then === 'function';\r\n  }\r\n}\r\n","import {Component, OnDestroy, OnInit} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { Breadcrumb } from './breadcrumb';\r\nimport { PpBreadcrumbsService } from './breadcrumbs.service';\r\n\r\n@Component({\r\n  selector: 'pp-breadcrumbs',\r\n  templateUrl: './breadcrumbs.component.html',\r\n  styleUrls: ['./breadcrumbs.component.scss']\r\n})\r\nexport class PpBreadcrumbsComponent implements OnInit, OnDestroy {\r\n  crumbs: Breadcrumb[];\r\n  subscriptions: Subscription[] = [];\r\n\r\n  constructor(public service: PpBreadcrumbsService) {}\r\n\r\n  public ngOnInit(): void {\r\n    this.subscriptions.push(\r\n      this.service.crumbs$.subscribe(x => {\r\n        this.crumbs = x;\r\n      })\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscriptions.forEach(x => x.unsubscribe());\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport {RouterModule} from '@angular/router';\nimport {CommonModule} from '@angular/common';\n\nimport { PpBreadcrumbsComponent } from './breadcrumbs.component';\n\n@NgModule({\n  declarations: [PpBreadcrumbsComponent],\n  imports: [CommonModule, RouterModule],\n  exports: [PpBreadcrumbsComponent]\n})\nexport class PpBreadcrumbsModule { }\n"],"names":[],"mappings":"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"}
