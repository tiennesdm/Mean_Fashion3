/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component } from '@angular/core';
import { ActivatedRoute, Router, NavigationEnd, PRIMARY_OUTLET } from '@angular/router';
import { filter } from 'rxjs/operators';
import { map } from 'rxjs/internal/operators';
import { Ng7MatBreadcrumbService } from './ng7-mat-breadcrumb.service';
var Ng7MatBreadcrumbComponent = /** @class */ (function () {
    function Ng7MatBreadcrumbComponent(activatedRoute, router, ng7MatBreadcrumbService) {
        this.activatedRoute = activatedRoute;
        this.router = router;
        this.ng7MatBreadcrumbService = ng7MatBreadcrumbService;
        this.breadcrumb = [];
        this.breadCrumbData();
    }
    /**
     * @return {?}
     */
    Ng7MatBreadcrumbComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.ng7MatBreadcrumbService.breadcrumbLabels.subscribe((/**
         * @param {?} labelData
         * @return {?}
         */
        function (labelData) {
            var _loop_1 = function (label) {
                if (labelData.hasOwnProperty(label)) {
                    _this.breadcrumb.map((/**
                     * @param {?} crumb
                     * @return {?}
                     */
                    function (crumb) {
                        var e_1, _a;
                        /** @type {?} */
                        var labelParams = crumb.label.match(/[^{{]+(?=\}})/g);
                        if (labelParams) {
                            try {
                                for (var labelParams_1 = tslib_1.__values(labelParams), labelParams_1_1 = labelParams_1.next(); !labelParams_1_1.done; labelParams_1_1 = labelParams_1.next()) {
                                    var labelParam = labelParams_1_1.value;
                                    /** @type {?} */
                                    var dyanmicData = labelData[label];
                                    if (labelParam === label) {
                                        crumb.label = crumb.label.replace('{{' + labelParam + '}}', dyanmicData);
                                    }
                                }
                            }
                            catch (e_1_1) { e_1 = { error: e_1_1 }; }
                            finally {
                                try {
                                    if (labelParams_1_1 && !labelParams_1_1.done && (_a = labelParams_1.return)) _a.call(labelParams_1);
                                }
                                finally { if (e_1) throw e_1.error; }
                            }
                        }
                    }));
                }
            };
            for (var label in labelData) {
                _loop_1(label);
            }
        }));
    };
    /**
     * @return {?}
     */
    Ng7MatBreadcrumbComponent.prototype.breadCrumbData = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.router.events
            .pipe(filter((/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return event instanceof NavigationEnd; })))
            .pipe(map((/**
         * @return {?}
         */
        function () { return _this.activatedRoute; })))
            .pipe(map((/**
         * @param {?} route
         * @return {?}
         */
        function (route) {
            while (route.firstChild) {
                route = route.firstChild;
            }
            return route;
        })))
            .pipe(filter((/**
         * @param {?} route
         * @return {?}
         */
        function (route) { return route.outlet === PRIMARY_OUTLET; })))
            .subscribe((/**
         * @param {?} route
         * @return {?}
         */
        function (route) {
            if (route.snapshot.data.breadcrumb) {
                /** @type {?} */
                var breadcrumb = (JSON.parse(JSON.stringify(route.snapshot.data.breadcrumb)));
                breadcrumb.map((/**
                 * @param {?} crumb
                 * @return {?}
                 */
                function (crumb) {
                    var e_2, _a, e_3, _b;
                    /** @type {?} */
                    var urlChunks = crumb.url.split('/');
                    try {
                        for (var urlChunks_1 = tslib_1.__values(urlChunks), urlChunks_1_1 = urlChunks_1.next(); !urlChunks_1_1.done; urlChunks_1_1 = urlChunks_1.next()) {
                            var chunk = urlChunks_1_1.value;
                            if (chunk.includes(':')) {
                                /** @type {?} */
                                var paramID = chunk.replace(':', '');
                                /** @type {?} */
                                var routerParamID = route.snapshot.params[paramID];
                                crumb.url = crumb.url.replace(":" + paramID, routerParamID);
                            }
                        }
                    }
                    catch (e_2_1) { e_2 = { error: e_2_1 }; }
                    finally {
                        try {
                            if (urlChunks_1_1 && !urlChunks_1_1.done && (_a = urlChunks_1.return)) _a.call(urlChunks_1);
                        }
                        finally { if (e_2) throw e_2.error; }
                    }
                    /** @type {?} */
                    var labelParams = crumb.label.match(/[^{{]+(?=\}})/g);
                    if (labelParams) {
                        try {
                            for (var labelParams_2 = tslib_1.__values(labelParams), labelParams_2_1 = labelParams_2.next(); !labelParams_2_1.done; labelParams_2_1 = labelParams_2.next()) {
                                var labelParam = labelParams_2_1.value;
                                /** @type {?} */
                                var routerParamID = route.snapshot.params[labelParam.trim()];
                                if (routerParamID) {
                                    crumb.label = crumb.label.replace('{{' + labelParam + '}}', routerParamID);
                                }
                                else {
                                    // crumb.label = crumb.label.replace('{{' + labelParam + '}}', '');
                                }
                            }
                        }
                        catch (e_3_1) { e_3 = { error: e_3_1 }; }
                        finally {
                            try {
                                if (labelParams_2_1 && !labelParams_2_1.done && (_b = labelParams_2.return)) _b.call(labelParams_2);
                            }
                            finally { if (e_3) throw e_3.error; }
                        }
                    }
                }));
                _this.breadcrumb = breadcrumb;
            }
            else {
                _this.breadcrumb = [];
            }
        }));
    };
    Ng7MatBreadcrumbComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-ng7-mat-breadcrumb',
                    template: "<mat-toolbar class=\"mat-bread-crumb\">\n    <mat-list class=\"mat-bread-crumb-list\" *ngIf=\"breadcrumb.length\">\n        <mat-list-item>\n            <span class=\"mat-bread-crumb-spacer\">\n                <span *ngFor=\"let item of breadcrumb; let i = index\">\n                    <a *ngIf=\"item?.url\" [routerLink]=\"item?.url\" class=\"mat-bread-crumb-list-item\">{{ item.label }}</a>\n                    <span *ngIf=\"!item?.url\" class=\"mat-bread-crumb-list-item\">{{ item.label }}</span>\n                    <span *ngIf=\"breadcrumb.length !== i+1\"> / </span>\n                </span>\n            </span>\n        </mat-list-item>\n    </mat-list>\n</mat-toolbar>",
                    styles: [".mat-bread-crumb{height:30px;background-color:#f1efeb}.mat-bread-crumb-list{padding-bottom:10px}.mat-bread-crumb-list-item{font-size:15px}.mat-bread-crumb-spacer{margin-left:-20px}"]
                }] }
    ];
    /** @nocollapse */
    Ng7MatBreadcrumbComponent.ctorParameters = function () { return [
        { type: ActivatedRoute },
        { type: Router },
        { type: Ng7MatBreadcrumbService }
    ]; };
    return Ng7MatBreadcrumbComponent;
}());
export { Ng7MatBreadcrumbComponent };
if (false) {
    /** @type {?} */
    Ng7MatBreadcrumbComponent.prototype.breadcrumb;
    /**
     * @type {?}
     * @private
     */
    Ng7MatBreadcrumbComponent.prototype.activatedRoute;
    /**
     * @type {?}
     * @private
     */
    Ng7MatBreadcrumbComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    Ng7MatBreadcrumbComponent.prototype.ng7MatBreadcrumbService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmc3LW1hdC1icmVhZGNydW1iLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nNy1tYXQtYnJlYWRjcnVtYi8iLCJzb3VyY2VzIjpbImxpYi9uZzctbWF0LWJyZWFkY3J1bWIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDekQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLGNBQWMsRUFBb0IsTUFBTSxpQkFBaUIsQ0FBQztBQUMxRyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEMsT0FBTyxFQUFFLEdBQUcsRUFBWSxNQUFNLHlCQUF5QixDQUFDO0FBRXhELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRXZFO0lBUUUsbUNBQ1UsY0FBOEIsRUFDOUIsTUFBYyxFQUNkLHVCQUFnRDtRQUZoRCxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLDRCQUF1QixHQUF2Qix1QkFBdUIsQ0FBeUI7UUFMMUQsZUFBVSxHQUFpQixFQUFFLENBQUM7UUFPNUIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3hCLENBQUM7Ozs7SUFFRCw0Q0FBUTs7O0lBQVI7UUFBQSxpQkFtQkM7UUFsQkMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLGdCQUFnQixDQUFDLFNBQVM7Ozs7UUFBQyxVQUFDLFNBQVM7b0NBQ3JELEtBQUs7Z0JBQ2QsSUFBSSxTQUFTLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxFQUFFO29CQUNuQyxLQUFJLENBQUMsVUFBVSxDQUFDLEdBQUc7Ozs7b0JBQUMsVUFBQyxLQUFLOzs7NEJBQ2xCLFdBQVcsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQzt3QkFDdkQsSUFBSSxXQUFX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SSxHQUFHLFVBQVUsR0FBRyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUM7aUNBQzVFO3FDQUFNO29DQUNMLG1FQUFtRTtpQ0FDcEU7NkJBQ0Y7Ozs7Ozs7OztxQkFDRjtnQkFFSCxDQUFDLEVBQUMsQ0FBQztnQkFDSCxLQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQzthQUM5QjtpQkFBTTtnQkFDTCxLQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQzthQUN0QjtRQUNILENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQzs7Z0JBOUVGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsd0JBQXdCO29CQUNsQyxvckJBQWtEOztpQkFFbkQ7Ozs7Z0JBVlEsY0FBYztnQkFBRSxNQUFNO2dCQUl0Qix1QkFBdUI7O0lBaUZoQyxnQ0FBQztDQUFBLEFBL0VELElBK0VDO1NBMUVZLHlCQUF5Qjs7O0lBQ3BDLCtDQUE4Qjs7Ozs7SUFHNUIsbURBQXNDOzs7OztJQUN0QywyQ0FBc0I7Ozs7O0lBQ3RCLDREQUF3RCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFJvdXRlciwgTmF2aWdhdGlvbkVuZCwgUFJJTUFSWV9PVVRMRVQsIFJvdXRlc1JlY29nbml6ZWQgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgbWFwLCBtZXJnZU1hcCB9IGZyb20gJ3J4anMvaW50ZXJuYWwvb3BlcmF0b3JzJztcbmltcG9ydCB7IEJyZWFkY3J1bWIgfSBmcm9tICcuL2JyZWFkY3J1bWIubW9kZWwnO1xuaW1wb3J0IHsgTmc3TWF0QnJlYWRjcnVtYlNlcnZpY2UgfSBmcm9tICcuL25nNy1tYXQtYnJlYWRjcnVtYi5zZXJ2aWNlJztcbmltcG9ydCB7IGZyb20gfSBmcm9tICdyeGpzJztcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FwcC1uZzctbWF0LWJyZWFkY3J1bWInLFxuICB0ZW1wbGF0ZVVybDogJy4vbmc3LW1hdC1icmVhZGNydW1iLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbmc3LW1hdC1icmVhZGNydW1iLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBOZzdNYXRCcmVhZGNydW1iQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgYnJlYWRjcnVtYjogQnJlYWRjcnVtYltdID0gW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIG5nN01hdEJyZWFkY3J1bWJTZXJ2aWNlOiBOZzdNYXRCcmVhZGNydW1iU2VydmljZVxuICApIHtcbiAgICB0aGlzLmJyZWFkQ3J1bWJEYXRhKCk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLm5nN01hdEJyZWFkY3J1bWJTZXJ2aWNlLmJyZWFkY3J1bWJMYWJlbHMuc3Vic2NyaWJlKChsYWJlbERhdGEpID0+IHtcbiAgICAgIGZvciAoY29uc3QgbGFiZWwgaW4gbGFiZWxEYXRhKSB7XG4gICAgICAgIGlmIChsYWJlbERhdGEuaGFzT3duUHJvcGVydHkobGFiZWwpKSB7XG4gICAgICAgICAgdGhpcy5icmVhZGNydW1iLm1hcCgoY3J1bWIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsUGFyYW1zID0gY3J1bWIubGFiZWwubWF0Y2goL1tee3tdKyg/PVxcfX0pL2cpO1xuICAgICAgICAgICAgaWYgKGxhYmVsUGFyYW1zKSB7XG4gICAgICAgICAgICAgIGZvciAoY29uc3QgbGFiZWxQYXJhbSBvZiBsYWJlbFBhcmFtcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGR5YW5taWNEYXRhID0gbGFiZWxEYXRhW2xhYmVsXTtcbiAgICAgICAgICAgICAgICBpZiAobGFiZWxQYXJhbSA9PT0gbGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgIGNydW1iLmxhYmVsID0gY3J1bWIubGFiZWwucmVwbGFjZSgne3snICsgbGFiZWxQYXJhbSArICd9fScsIGR5YW5taWNEYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgfSk7XG4gIH1cblxuICBicmVhZENydW1iRGF0YSgpIHtcbiAgICB0aGlzLnJvdXRlci5ldmVudHNcbiAgICAgIC5waXBlKGZpbHRlcihldmVudCA9PiBldmVudCBpbnN0YW5jZW9mIE5hdmlnYXRpb25FbmQpKVxuICAgICAgLnBpcGUobWFwKCgpID0+IHRoaXMuYWN0aXZhdGVkUm91dGUpKVxuICAgICAgLnBpcGUobWFwKChyb3V0ZSkgPT4ge1xuICAgICAgICB3aGlsZSAocm91dGUuZmlyc3RDaGlsZCkgeyByb3V0ZSA9IHJvdXRlLmZpcnN0Q2hpbGQ7IH1cbiAgICAgICAgcmV0dXJuIHJvdXRlO1xuICAgICAgfSkpXG4gICAgICAucGlwZShmaWx0ZXIocm91dGUgPT4gcm91dGUub3V0bGV0ID09PSBQUklNQVJZX09VVExFVCkpXG4gICAgICAuc3Vic2NyaWJlKHJvdXRlID0+IHtcblxuICAgICAgICBpZiAocm91dGUuc25hcHNob3QuZGF0YS5icmVhZGNydW1iKSB7XG4gICAgICAgICAgY29uc3QgYnJlYWRjcnVtYiA9IChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJvdXRlLnNuYXBzaG90LmRhdGEuYnJlYWRjcnVtYikpKTtcbiAgICAgICAgICBicmVhZGNydW1iLm1hcCgoY3J1bWIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHVybENodW5rcyA9IGNydW1iLnVybC5zcGxpdCgnLycpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBjaHVuayBvZiB1cmxDaHVua3MpIHtcbiAgICAgICAgICAgICAgaWYgKGNodW5rLmluY2x1ZGVzKCc6JykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbUlEID0gY2h1bmsucmVwbGFjZSgnOicsICcnKTtcbiAgICAgICAgICAgICAgICBjb25zdCByb3V0ZXJQYXJhbUlEID0gcm91dGUuc25hcHNob3QucGFyYW1zW3BhcmFtSURdO1xuICAgICAgICAgICAgICAgIGNydW1iLnVybCA9IGNydW1iLnVybC5yZXBsYWNlKGA6JHtwYXJhbUlEfWAsIHJvdXRlclBhcmFtSUQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGxhYmVsUGFyYW1zID0gY3J1bWIubGFiZWwubWF0Y2goL1tee3tdKyg/PVxcfX0pL2cpO1xuICAgICAgICAgICAgaWYgKGxhYmVsUGFyYW1zKSB7XG4gICAgICAgICAgICAgIGZvciAoY29uc3QgbGFiZWxQYXJhbSBvZiBsYWJlbFBhcmFtcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvdXRlclBhcmFtSUQgPSByb3V0ZS5zbmFwc2hvdC5wYXJhbXNbbGFiZWxQYXJhbS50cmltKCldO1xuICAgICAgICAgICAgICAgIGlmIChyb3V0ZXJQYXJhbUlEKSB7XG4gICAgICAgICAgICAgICAgICBjcnVtYi5sYWJlbCA9IGNydW1iLmxhYmVsLnJlcGxhY2UoJ3t7JyArIGxhYmVsUGFyYW0gKyAnfX0nLCByb3V0ZXJQYXJhbUlEKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgLy8gY3J1bWIubGFiZWwgPSBjcnVtYi5sYWJlbC5yZXBsYWNlKCd7eycgKyBsYWJlbFBhcmFtICsgJ319JywgJycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy5icmVhZGNydW1iID0gYnJlYWRjcnVtYjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmJyZWFkY3J1bWIgPSBbXTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cbn1cbiJdfQ==